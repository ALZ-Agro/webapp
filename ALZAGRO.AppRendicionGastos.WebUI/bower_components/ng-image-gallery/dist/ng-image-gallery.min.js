(function(){'use strict';var keys={enter:13,esc:27,left:37,right:39};angular.module('thatisuday.ng-image-gallery',['ngAnimate']).provider('ngImageGalleryOpts',function(){var defOpts={thumbnails:!0,thumbSize:80,inline:!1,bubbles:!0,bubbleSize:20,imgBubbles:!1,bgClose:!1,piracy:!1,imgAnim:'fadeup',errorPlaceHolder:'¡Error cargando la imágen!'};return{setOpts:function(newOpts){angular.extend(defOpts,newOpts)},$get:function(){return defOpts}}}).filter('ngImageGalleryTrust',['$sce',function($sce){return function(value,type){return $sce.trustAs(type||'html',value)}}]).directive('ngRightClick',['$parse',function($parse){return{restrict:"A",scope:!1,link:function(scope,element,attrs){element.bind('contextmenu',function(event){if(scope.piracy==!1){event.preventDefault();return scope.piracy}})}}}]).directive("showImageAsync",[function(){return{restrict:"A",scope:!1,link:function(scope,element,attributes){var image=new Image();image.src=attributes.showImageAsync;image.onload=function(){scope.$apply(function(){if(attributes.asyncKind=='thumb'){element.css({backgroundImage:'url("'+attributes.showImageAsync+'")'});element.empty()}
else if(attributes.asyncKind=='bubble'){element.css({backgroundImage:'url("'+attributes.showImageAsync+'")'})}})};image.onerror=function(){element.empty()}}}}]).directive("bubbleAutoFit",['$window','$timeout',function($window,$timeout){return{restrict:"A",scope:!1,link:{pre:function(scope,element,attributes){var autoFitBubbles=function(){var scrollerWidth=element[0].getBoundingClientRect().width;if(scrollerWidth==0)return;var bubbleSize=scope.bubbleSize;var minMargin=4+4;var bubbleSpace=(bubbleSize+minMargin);var rawQuotient=scrollerWidth/bubbleSpace;var bubblesInView=Math.floor(rawQuotient);var extraSpace=scrollerWidth-(bubblesInView*bubbleSpace);var extraMargin=extraSpace/bubblesInView;var bubbleMargin=minMargin+extraMargin;var finalBubbleSpace=bubbleMargin+bubbleSize;scope._bubblesInView=bubblesInView;scope._finalBubbleSpace=finalBubbleSpace;scope._bubbleMargin='0 '+(bubbleMargin/2)+'px';scope._safeApply(angular.noop)};$timeout(autoFitBubbles);angular.element($window).bind('resize',function(){$timeout(autoFitBubbles)});scope.$watch('inline',function(){$timeout(autoFitBubbles)});scope.$watch('bubbleSize',function(){$timeout(autoFitBubbles)});scope.$watchCollection('images',function(){$timeout(autoFitBubbles)})}}}}]).directive("bubbleAutoScroll",['$window','$timeout',function($window,$timeout){return{restrict:"A",scope:!1,link:function(scope,element,attributes){var indexCalc=function(){var relativeIndexToBubbleWrapper=scope._bubblesInView-(scope._bubblesInView-scope._activeImageIndex);$timeout(function(){if(relativeIndexToBubbleWrapper>scope._bubblesInView-2){var outBubbles=((scope._activeImageIndex+1)-scope._bubblesInView)+1;if(scope._activeImageIndex!=(scope.images.length-1)){scope._bubblesContainerMarginLeft='-'+(scope._finalBubbleSpace*outBubbles)+'px'}
else{scope._bubblesContainerMarginLeft='-'+(scope._finalBubbleSpace*(outBubbles-1))+'px'}}
else{scope._bubblesContainerMarginLeft='0px'}})}
angular.element($window).bind('resize',function(){$timeout(indexCalc)});scope.$watch('_bubblesInView',function(){$timeout(indexCalc)});scope.$watch('_activeImageIndex',function(){$timeout(indexCalc)});scope.$watchCollection('images',function(){$timeout(indexCalc)})}}}]).directive('ngImageGallery',['$rootScope','$timeout','$q','ngImageGalleryOpts',function($rootScope,$timeout,$q,ngImageGalleryOpts){return{replace:!0,transclude:!1,restrict:'AE',scope:{images:'=',methods:'=?',conf:'=?',thumbnails:'=?',thumbSize:'=?',inline:'=?',bubbles:'=?',bubbleSize:'=?',imgBubbles:'=?',bgClose:'=?',piracy:'=?',imgAnim:'@?',errorPlaceHolder:'@?',onOpen:'&?',onClose:'&?',onDelete:'&?'},template:'<div class="ng-image-gallery img-move-dir-{{_imgMoveDirection}}" ng-class="{inline:inline,trasparent:forceModal}" ng-hide="images.length == 0">'+'<div ng-if="thumbnails && !inline" class="ng-image-gallery-thumbnails">'+'<div class="thumb" ng-repeat="image in images track by image.id" ng-click="methods.open($index);" show-image-async="{{image.thumbUrl || image.url}}" async-kind="thumb" ng-style="{\'width\' : thumbSize+\'px\', \'height\' : thumbSize+\'px\'}">'+'<div class="loader"></div>'+'</div>'+'</div>'+'<div class="ng-image-gallery-modal" ng-if="opened" ng-cloak>'+'<div class="ng-image-gallery-backdrop" ng-if="!inline"></div>'+'<div class="ng-image-gallery-content" ng-show="!imgLoading" ng-click="backgroundClose($event);">'+'<div class="actions-icons-container">'+'<div class="delete-img" ng-repeat="image in images track by image.id" ng-if="_activeImg == image && image.deletable" title="Delete this image..." ng-click="_deleteImg(image)"></div>'+'</div>'+'<div class="control-icons-container">'+'<a class="ext-url" ng-repeat="image in images track by image.id" ng-if="_activeImg == image && image.extUrl" href="{{image.extUrl}}" target="_blank" title="Open image in new tab..."></a>'+'<div class="close" ng-click="methods.close();" ng-if="!inline"></div>'+'</div>'+'<div class="prev" ng-click="methods.prev();" ng-class="{\'bubbles-on\':bubbles}" ng-hide="images.length == 1"></div>'+'<div class="next" ng-click="methods.next();" ng-class="{\'bubbles-on\':bubbles}" ng-hide="images.length == 1"></div>'+'<div class="galleria">'+'<div class="galleria-images img-anim-{{imgAnim}} img-move-dir-{{_imgMoveDirection}}">'+'<img class="galleria-image" ng-right-click ng-repeat="image in images track by image.id" ng-if="_activeImg == image" ng-src="{{image.url}}" ondragstart="return false;" ng-click="methods.openModalForInlineGallery($index)" ng-attr-alt="{{image.alt || undefined}}"/>'+'</div>'+'<div class="galleria-title-description-wrapper">'+'<div ng-repeat="image in images track by image.id" ng-if="(image.title || image.desc) && (_activeImg == image)">'+'<div class="title" ng-if="image.title" ng-bind-html="image.title | ngImageGalleryTrust"></div>'+'<div class="desc" ng-if="image.desc" ng-bind-html="image.desc | ngImageGalleryTrust"></div>'+'</div>'+'</div>'+'<div class="galleria-bubbles-wrapper" ng-if="bubbles && !imgBubbles" ng-hide="images.length == 1" ng-style="{\'height\' : bubbleSize+\'px\'}" bubble-auto-fit>'+'<div class="galleria-bubbles" bubble-auto-scroll ng-style="{\'margin-left\': _bubblesContainerMarginLeft}">'+'<span class="galleria-bubble" ng-click="_setActiveImg(image);" ng-repeat="image in images track by image.id" ng-class="{active : (_activeImg == image)}" ng-style="{\'width\' : bubbleSize+\'px\', \'height\' : bubbleSize+\'px\', margin: _bubbleMargin}"></span>'+'</div>'+'</div>'+'<div class="galleria-bubbles-wrapper" ng-if="bubbles && imgBubbles" ng-hide="images.length == 1" ng-style="{\'height\' : bubbleSize+\'px\'}" bubble-auto-fit>'+'<div class="galleria-bubbles" bubble-auto-scroll ng-style="{\'margin-left\': _bubblesContainerMarginLeft}">'+'<span class="galleria-bubble img-bubble" ng-click="_setActiveImg(image);" ng-repeat="image in images track by image.id" ng-class="{active : (_activeImg == image)}" show-image-async="{{image.bubbleUrl || image.thumbUrl || image.url}}" async-kind="bubble" ng-style="{\'width\' : bubbleSize+\'px\', \'height\' : bubbleSize+\'px\', \'border-width\' : bubbleSize/10+\'px\', margin: _bubbleMargin}"></span>'+'</div>'+'</div>'+'</div>'+'</div>'+'<div class="ng-image-gallery-loader" ng-show="imgLoading">'+'<div class="spinner">'+'<div class="rect1"></div>'+'<div class="rect2"></div>'+'<div class="rect3"></div>'+'<div class="rect4"></div>'+'<div class="rect5"></div>'+'</div>'+'</div>'+'<div class="ng-image-gallery-errorplaceholder" ng-show="imgError">'+'<div class="ng-image-gallery-error-placeholder" ng-bind-html="errorPlaceHolder | ngImageGalleryTrust"></div>'+'</div>'+'</div>'+'</div>',link:{pre:function(scope,elem,attr,rootScope){scope._showLoader=function(){scope.imgLoading=!0}
scope._hideLoader=function(){scope.imgLoading=!1}
scope._loadImg=function(imgObj){if(!imgObj)return $q.reject();var deferred=$q.defer();if(!imgObj.hasOwnProperty('cached'))scope._showLoader();var img=new Image();img.src=imgObj.url;img.onload=function(){if(!imgObj.hasOwnProperty('cached'))scope._hideLoader();if(!imgObj.hasOwnProperty('cached'))imgObj.cached=!0;deferred.resolve(imgObj)}
img.onerror=function(){if(!imgObj.hasOwnProperty('cached'))scope._hideLoader();deferred.reject('Error when loading img')}
return deferred.promise}
scope._setActiveImg=function(imgObj){if(scope.images.indexOf(scope._activeImg)-scope.images.indexOf(imgObj)==(scope.images.length-1)||(scope.images.indexOf(scope._activeImg)-scope.images.indexOf(imgObj)<=0&&scope.images.indexOf(scope._activeImg)-scope.images.indexOf(imgObj)!=-(scope.images.length-1))){scope._imgMoveDirection='forward'}
else{scope._imgMoveDirection='backward'}
scope._loadImg(imgObj).then(function(imgObj){scope._activeImg=imgObj;scope._activeImageIndex=scope.images.indexOf(imgObj);scope.imgError=!1},function(){scope._activeImg=null;scope._activeImageIndex=scope.images.indexOf(imgObj);scope.imgError=!0})}
scope._safeApply=function(fn){var phase=this.$root.$$phase;if(phase=='$apply'||phase=='$digest'){if(fn&&(typeof(fn)==='function')){fn()}}else{this.$apply(fn)}};scope._deleteImg=function(img){var _deleteImgCallback=function(){var index=scope.images.indexOf(img);console.log(index);scope.images.splice(index,1);scope._activeImageIndex=0}
scope.onDelete({img:img,cb:_deleteImgCallback})}
scope.images=(scope.images!=undefined)?scope.images:[];scope.methods=(scope.methods!=undefined)?scope.methods:{};scope.conf=(scope.conf!=undefined)?scope.conf:{};scope.$watchCollection('conf',function(conf){scope.thumbnails=(conf.thumbnails!=undefined)?conf.thumbnails:(scope.thumbnails!=undefined)?scope.thumbnails:ngImageGalleryOpts.thumbnails;scope.thumbSize=(conf.thumbSize!=undefined)?conf.thumbSize:(scope.thumbSize!=undefined)?scope.thumbSize:ngImageGalleryOpts.thumbSize;scope.inline=(conf.inline!=undefined)?conf.inline:(scope.inline!=undefined)?scope.inline:ngImageGalleryOpts.inline;scope.bubbles=(conf.bubbles!=undefined)?conf.bubbles:(scope.bubbles!=undefined)?scope.bubbles:ngImageGalleryOpts.bubbles;scope.bubbleSize=(conf.bubbleSize!=undefined)?conf.bubbleSize:(scope.bubbleSize!=undefined)?scope.bubbleSize:ngImageGalleryOpts.bubbleSize;scope.imgBubbles=(conf.imgBubbles!=undefined)?conf.imgBubbles:(scope.imgBubbles!=undefined)?scope.imgBubbles:ngImageGalleryOpts.imgBubbles;scope.bgClose=(conf.bgClose!=undefined)?conf.bgClose:(scope.bgClose!=undefined)?scope.bgClose:ngImageGalleryOpts.bgClose;scope.piracy=(conf.piracy!=undefined)?conf.piracy:(scope.piracy!=undefined)?scope.piracy:ngImageGalleryOpts.piracy;scope.imgAnim=(conf.imgAnim!=undefined)?conf.imgAnim:(scope.imgAnim!=undefined)?scope.imgAnim:ngImageGalleryOpts.imgAnim;scope.errorPlaceHolder=(conf.errorPlaceHolder!=undefined)?conf.errorPlaceHolder:(scope.errorPlaceHolder!=undefined)?scope.errorPlaceHolder:ngImageGalleryOpts.errorPlaceHolder});scope.onOpen=(scope.onOpen!=undefined)?scope.onOpen:angular.noop;scope.onClose=(scope.onClose!=undefined)?scope.onClose:angular.noop;scope.onDelete=(scope.onDelete!=undefined)?scope.onDelete:angular.noop;var imagesFirstWatch=!0;scope.$watchCollection('images',function(){if(imagesFirstWatch){imagesFirstWatch=!1}
else if(scope.images.length){scope._setActiveImg(scope.images[scope._activeImageIndex||0])}});var activeImageIndexFirstWatch=!0;scope.$watch('_activeImageIndex',function(newImgIndex){if(activeImageIndexFirstWatch){activeImageIndexFirstWatch=!1}
else if(scope.images.length){scope._setActiveImg(scope.images[newImgIndex])}});scope.$watch('inline',function(){$timeout(function(){if(scope.inline)scope.methods.open()})});if(scope.inline){scope.$on('disableForceModal',function(){scope.forceModal=!1})}
scope.$on('set-modal-index',function(event,index){scope._activeImageIndex=(index)?index:0;scope.opened=!0});scope.methods.openModalForInlineGallery=function(imgIndex){scope.forceModal=!0;$rootScope.$broadcast('image-opened',imgIndex)}
scope.methods.open=function(imgIndex){scope._activeImageIndex=(imgIndex)?imgIndex:0;scope.opened=!0;if(!scope.inline)angular.element(document.body).addClass('body-overflow-hidden');$timeout(function(){scope.onOpen()},300)}
scope.methods.close=function(){scope.opened=!1;$rootScope.$broadcast('disableForceModal');angular.element(document.body).removeClass('body-overflow-hidden');$timeout(function(){scope.onClose();scope._activeImageIndex=0},300)}
scope.methods.next=function(){if(scope._activeImageIndex==(scope.images.length-1)){scope._activeImageIndex=0}
else{scope._activeImageIndex=scope._activeImageIndex+1}}
scope.methods.prev=function(){if(scope._activeImageIndex==0){scope._activeImageIndex=scope.images.length-1}
else{scope._activeImageIndex--}}
scope.backgroundClose=function(e){if(!scope.bgClose||scope.inline)return;var noCloseClasses=['galleria-image','destroy-icons-container','ext-url','close','next','prev','galleria-bubble'];for(var i=0;i<e.target.classList.length;i++){if(noCloseClasses.indexOf(e.target.classList[i])!=-1){break}
else{scope.methods.close()}}}
angular.element(document).bind('keyup',function(event){if(scope.inline)return;if(event.which==keys.right||event.which==keys.enter){$timeout(function(){scope.methods.next()})}
else if(event.which==keys.left){$timeout(function(){scope.methods.prev()})}
else if(event.which==keys.esc){$timeout(function(){scope.methods.close()})}});if(window.Hammer){var hammerElem=new Hammer(elem[0]);hammerElem.on('swiperight',function(ev){$timeout(function(){scope.methods.prev()})});hammerElem.on('swipeleft',function(ev){$timeout(function(){scope.methods.next()})});hammerElem.on('doubletap',function(ev){if(scope.inline)return;$timeout(function(){scope.methods.close()})})};var removeClassFromDocumentBody=function(){angular.element(document.body).removeClass('body-overflow-hidden')};$rootScope.$on('$stateChangeSuccess',removeClassFromDocumentBody);$rootScope.$on('$routeChangeSuccess',removeClassFromDocumentBody)}}}}])})()